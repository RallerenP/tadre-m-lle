<!DOCTYPE html>
<html class="bg-default h-screen w-screen overflow-x-hidden" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tadre Mølle / opret</title>
    <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <link href="/css/custom.css" rel="stylesheet">
    <script type="module" src="/components/index.js"></script>
</head>
<body class="h-full w-full">
<tadre-header></tadre-header>
<tadre-title>Opret ny side!</tadre-title>
<div>
    <div class="w-full text-center text-4xl flex justify-center items-center">
        <label>Titel</label>
    </div>
    <div class="w-full text-center text-4xl flex justify-center items-center">
        <input class="w-96 border-solid border-4 border-light-blue-500" type="text" id="titel" name="titel">
    </div>
    <div  class="w-full text-center text-4xl flex justify-center items-center">
        <label><input class="w-96 border-solid border-4 border-light-blue-500" type="text" id="titel-image" name="titel-image"></label>
    </div>
    <div class="w-full text-center text-4xl flex justify-center items-center">
        <label for="indhold">Indhold</label>
    </div>
    <div class="w-full text-center text-4xl flex justify-center items-center">
        <textarea class="h-48 w-96 border-solid border-4 border-light-blue-500" type="text" id="indhold"
                  name="indhold"></textarea>
    </div>
    <div class="w-full text-center text-4xl flex justify-center items-center">
        <label>Tags</label>
    </div>
    <div class="w-full text-center text-4xl flex justify-center items-center">
        <input class="w-96 border-solid border-4 border-light-blue-500" type="text" id="tags" name="tags">
        <button class="m-4" id="addTags">Tilføj tag</button>
    </div>
    <div class="w-full text-center text-4xl flex justify-center items-center">
        <button class="m-4" id="cancelButton">Annuller</button>
        <button class="m-4" id="submitButton">Opret</button>
    </div>
    <div id="tagsviewer" class="w-full text-center text-4xl flex justify-center items-center"></div>
</div>

<tadre-footer>
    <tadre-copyright slot="copyright"></tadre-copyright>
</tadre-footer>

<script>
    let tagsArray = [];
    $('#cancelButton').click(() => window.history.back());

    $("#submitButton").on("click", function () {
        const title = $("#titel").val();
        const content = $("#indhold").val();
        const url = urlConverter(title);
        const imageUrl = $("#titel-image").val();

        const data = JSON.stringify({
            title: title,
            content: content,
            url: `${url}`,
            tags: tagsArray,
            image: imageUrl
        })

        $.ajax({
            url: '/api/pages/',
            contentType: "application/json",
            method: 'POST',
            data: data,
            success: (data) => {
                window.location.href = `/artikel/${data.url}`
            }
        })

        function urlConverter(url) {
            let tmp = url.toLowerCase();
            tmp = tmp.replace(/æ/g, "ae")
            tmp = tmp.replace(/ø/g, "oe")
            tmp = tmp.replace(/å/g, "aa")
            return tmp.replace(/[\W_]+/g,"-");
        }
    });


    $("#addTags").on("click", function () {
        let tags = $("#tags").val();
        tagsArray.push(tags);
        console.log(tagsArray);
        tagsOverview();

        function tagsOverview (){
            const p = document.getElementById('tagsviewer');
            p.innerHTML = tagsArray;
            // message.append(p);
        }


    })


</script>

</body>
</html>